library(ape)
library(phangorn)
library(vegan)
library(ggplot2)
library(dplyr)
library(phytools)
library(rgl)
library(stringr)
library(evoldiver)
CHEM <- read.csv("Methyl Ether Matrix.csv")
install.packages("evoldiver")
CHEM[CHEM > 1] <- 1 # CONVERTS CHEM INTO A PRESENCE ABSENCE MATRIX
file_list = CHEM %>% pull(X)
file_list
CHEM
help(pull)
help("read.csv")
CHEM <- read.csv("Methyl Ether Matrix.csv")
file_list = CHEM %>% pull(X)
file_list
CHEM = CHEM %>% slice(c(1:246)) %>% select(c(1:145)) # Use this version for both M+F files
CHEM
cat("\014") # Clear console
rm(list=ls()) # Remove all variables to start with a clean slate
library(vegan)
library(ggplot2)
CHEM <-read.csv("Methyl Ether Matrix.csv", sep=",", row.names=1)
METADATA <- read.csv("Metadata.csv")
dim(CHEM)
#for the above code "rowSUMS (CHEM[,A:B])", you're indicating to sum each row from column A through column B
CHEMPP <- CHEM[,1:144]/rsums #calculates relative proportions + puts into a new matrix
dim(CHEMPP) #gives you number of rows, columns in the new matrix
rowSums (CHEMPP[,1:144]) #verifies that all porportions add up to 1
#if everything doesn't add up to 1, this probably means that you need to change the A:B situation
## Calculate the relative proportions of the areas of each peak
rsums <- rowSums (CHEM[,1:144]) #sums up values across columns of each row
#for the above code "rowSUMS (CHEM[,A:B])", you're indicating to sum each row from column A through column B
CHEMPP <- CHEM[,1:144]/rsums #calculates relative proportions + puts into a new matrix
dim(CHEMPP) #gives you number of rows, columns in the new matrix
rowSums (CHEMPP[,1:144]) #verifies that all porportions add up to 1
#if everything doesn't add up to 1, this probably means that you need to change the A:B situation
rsums <- rowSums (CHEM[,1:144]) #sums up values across columns of each row
dim(CHEM)
CHEM
CHEM[,1:144]
library(vegan)
library(ggplot2)
CHEM <-read.csv("Methyl Ether Matrix.csv", sep=",", row.names=1)
METADATA <- read.csv("Metadata.csv")
dim(CHEM)
rsums <- rowSums (CHEM[,1:144]) #sums up values across columns of each row
rowSums (CHEM)
dim(CHEM)
rsums <- rowSums (CHEM[,1:124])
dims <- dim(CHEM)
dims[2]
## Calculate the relative proportions of the areas of each peak
rsums <- rowSums (CHEM[,1:dims[2]]) #sums up values across all columns of each row
#for the above code "rowSUMS (CHEM[,A:B])", you're indicating to sum each row from column A through column B
CHEMPP <- CHEM[,1:dims[2]]/rsums #calculates relative proportions + puts into a new matrix
dim(CHEMPP) #gives you number of rows, columns in the new matrix
rowSums (CHEMPP[,1:dims[2]]) #verifies that all porportions add up to 1
#if everything doesn't add up to 1, this probably means that you need to change the A:B situation
row.names(CHEMPP)
## Export the CHEMPP results as a .csv file
write.csv(CHEMPP, file="CHEMPP.csv",row.names=TRUE)
CHEM_NMDS <- metaMDS(CHEMPP, distance="bray", k=2, trymax=100)
MDS1 = CHEM_NMDS$points[,1]
MDS2 = CHEM_NMDS$points[,2]
NMDS = data.frame(MDS1 = MDS1, MDS2 = MDS2, Species = METADATA$Species, Location = METADATA$Location, Sex = METADATA$Sex)
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Species)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Location)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Sex)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Location:Sex)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
Location:Sex
NMDS
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Location:Sex)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
NMDS
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Sex)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Location)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Location:Sex)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot")
NMDS
sum(is.na(NMDS$Sex))
sum(is.na(NMDS$Location))
sum(is.na(NMDS$Species))
library(ape)
library(phangorn)
library(vegan)
library(ggplot2)
library(dplyr)
library(phytools)
library(rgl)
library(stringr)
library(evoldiver)
install.packages(evoldiver)
install.packages("evoldiver")
install.packages("remotes")
remotes::install_github("manabusakamoto/evoldiver")
library(evoldiver)
CHEM <- read.csv("Methyl Ether Matrix.csv")
CHEM[CHEM > 1] <- 1 # CONVERTS CHEM INTO A PRESENCE ABSENCE MATRIX
file_list <- CHEM %>% pull(X)
file_list
CHEM
CHEM = CHEM %>% slice(c(1:246)) %>% select(c(1:145)) # Use this version for both M+F files
CHEM
write.csv(CHEM, file="CHEM.csv")
CHEM <- read.csv("CHEM.csv",row.names = "X")
dim(CHEM)
CHEM[is.na(CHEM)]
CHEM
rsums <- rowSums(CHEM[,2:145]) #sums up values across columns of each row
dims <- dim(CHEM) #3246 files, 124 MEs + 1 filename column X
rsums <- rowSums(CHEM[,2:dims[2]]) #sums up values across columns of each row
rsums
CHEM[,2:dims[2]]
CHEMPP <- CHEM[,2:dims[2]]/rsums #calculates relative proportions + puts into a new matrix
CHEMPP
dim(CHEMPP)
dimspp <- dim(CHEMPP) #246 files, 124 MEs
rowSums(CHEMPP[,2:dimspp[2]])
gsub(pattern = ".D.CSV_Area", replacement = "", x = row.names(CHEMPP))
row.names(CHEMPP)
dimspp <- dim(CHEMPP)
rowSums(CHEMPP[,2:dimspp[2]])
dimspp <- dim(CHEMPP)
cat("\014") # Clear console
rm(list=ls()) # Remove all variables to start with a clean slate
library(vegan)
library(ggplot2)
CHEM <-read.csv("Methyl Ether Matrix.csv", sep=",", row.names=1)
METADATA <- read.csv("Metadata.csv")
#below function spits out results showing your total number of rows and columns
dim(CHEM) #should be 246 rows, 124 cols
dims <- dim(CHEM)
rsums <- rowSums (CHEM[,1:dims[2]]) #sums up values across all columns of each row
#for the above code "rowSUMS (CHEM[,A:B])", you're indicating to sum each row from column A through column B
CHEMPP <- CHEM[,1:dims[2]]/rsums #calculates relative proportions + puts into a new matrix
dim(CHEMPP) #gives you number of rows, columns in the new matrix
rowSums (CHEMPP[,1:dims[2]])
sum(rowSums (CHEMPP[,1:dims[2]]) != 1)
rowSums[rowSums (CHEMPP[,1:dims[2]]) != 1)]
rowSums[rowSums (CHEMPP[,1:dims[2]]) != 1]
rowSums (CHEMPP[,1:dims[2]]) != 1
rowSums (CHEMPP[,1:dims[2]])[rowSums (CHEMPP[,1:dims[2]]) != 1]
sum(rowSums (CHEMPP[,1:dims[2]]))
CHEM <- read.csv("Methyl Ether Matrix.csv")
CHEM[CHEM > 1] <- 1 # CONVERTS CHEM INTO A PRESENCE ABSENCE MATRIX
CHEM
write.csv(CHEM, file="CHEM.csv")
CHEM <- read.csv("CHEM.csv",row.names = "X")
CHEM
CHEM <- read.csv("CHEM.csv")
CHEM
dim(CHEM)
CHEM[is.na(CHEM)] = 0
dim(CHEM)
CHEM[!is.na(CHEM)] = 0
CHEM <- read.csv("Methyl Ether Matrix.csv")
CHEM[CHEM > 1] <- 1 # CONVERTS CHEM INTO A PRESENCE ABSENCE MATRIX
CHEM
write.csv(CHEM, file="CHEM.csv")
CHEM <- read.csv("CHEM.csv")
dims <- dim(CHEM) #246 files, 124 MEs + 1 filename column X
CHEM
CHEM[,2:dims[2]]
View(CHEM)
CHEM <- read.csv("Methyl Ether Matrix.csv")
CHEM[CHEM > 1] <- 1 # CONVERTS CHEM INTO A PRESENCE ABSENCE MATRIX
CHEM
write.csv(CHEM, file="CHEM.csv")
CHEM <- read.csv("CHEM.csv", row.names="X")
CHEM <- CHEM[,3:dims[2]]
dims <- dim(CHEM)
CHEM[,3:dims[2]]
CHEM
CHEM <- CHEM[,3:dims[2]]
rsums <- rowSums(CHEM[,1:dims[2]]) #sums up values across columns of each row
dims <- dim(CHEM) #reset dims
rsums <- rowSums(CHEM[,1:dims[2]]) #sums up values across columns of each row
CHEMPP <- CHEM[,1:dims[2]]/rsums #calculates relative proportions + puts into a new matrix
CHEMPP
dimspp <- dim(CHEMPP) #246 files, 124 MEs
dimspp
dimspp
CHEMPP
CHEM <- read.csv("Methyl Ether Matrix.csv")
CHEM[CHEM > 1] <- 1 # CONVERTS CHEM INTO A PRESENCE ABSENCE MATRIX
CHEM
write.csv(CHEM, file="CHEM.csv")
CHEM <- read.csv("CHEM.csv")
dims <- dim(CHEM) #246 files, 124 MEs + 1 filename column X
dims
CHEM
CHEM[,2:dims[2]]
CHEM[,3:dims[2]] #remove extraneous rownames columns
CHEM
CHEM <- CHEM[,3:dims[2]] #remove extraneous rownames columns
dims <- dim(CHEM) #reset dims: 246 files, 124 MEs
dims
CHEM
rsums <- rowSums(CHEM[,1:dims[2]]) #sums up values across columns of each row
length(rsums)
CHEMPP <- CHEM[,1:dims[2]]/rsums #calculates relative proportions + puts into a new matrix
CHEMPP
dimspp <- dim(CHEMPP) #246 files, 124 MEs
dimspp
rowSums(CHEMPP[,1:dimspp[2]])
write.csv(CHEMPP, file="CHEMPP.csv",row.names=TRUE)
CHEMPP <- read.csv("CHEMPP.csv", sep=",", row.names=1)
CHEMPP
CHEM_NMDS <- metaMDS(CHEMPP, distance="bray", k=2, trymax=100) #runs multiple NMDS to find a stable solution
METADATA <- read.csv("Metadata.csv") # Reads in Metadata
length(METADATA$Sex)
length(METADATA$Species)
MDS1 = CHEM_NMDS$points[,1]
MDS2 = CHEM_NMDS$points[,2]
NMDS = data.frame(MDS1 = MDS1, MDS2 = MDS2, Species = METADATA$Species)
NMDS$Species = as.factor(NMDS$Species)
NMDS
ggplot(NMDS, aes(x=MDS1, y=MDS2, col=Species)) +
geom_point() +
stat_ellipse(level=0.65) +
theme_bw() +
labs(title = "NMDS Plot (Presence/Abundance)")
cent = aggregate(cbind(MDS1,MDS2)~Species,NMDS,mean)
row.names(cent) = cent$Species
cent = cent[-1]
species_tree = read.tree(file = "phylogeny_pruned_without_palu.nwk")
